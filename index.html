<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mysore & Coorg Expense Tracker</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
:root {
    --bg:#f8f9fa;
    --card:#ffffff;
    --text:#212529;
    --primary:#0d6efd;
}
body.dark {
    --bg:#121212;
    --card:#1e1e1e;
    --text:#eaeaea;
    --primary:#66b2ff;
}
body {
    font-family:Arial,sans-serif;
    background:var(--bg);
    color:var(--text);
    margin:0;
    padding:20px;
}
.container { max-width:1000px; margin:auto; }
.card {
    background:var(--card);
    padding:20px;
    border-radius:8px;
    box-shadow:0 4px 6px rgba(0,0,0,.1);
    margin-bottom:20px;
}
h1,h2,h3 { border-bottom:2px solid #ccc; padding-bottom:5px; }
.grid { display:grid; gap:20px; }
.grid-2 { grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); }

input,select {
    width:100%;
    padding:8px;
    margin-top:5px;
    border-radius:4px;
    border:1px solid #ccc;
}
button {
    background:var(--primary);
    color:white;
    padding:10px 15px;
    border:none;
    border-radius:4px;
    cursor:pointer;
    margin-top:15px;
}

/* Dark Mode Toggle */
.toggle {
    float:right;
    cursor:pointer;
    font-size:14px;
    padding:6px 10px;
    border-radius:20px;
    background:var(--primary);
    color:white;
}

/* Responsive Table */
table { width:100%; border-collapse:collapse; }
th,td { padding:8px; border-bottom:1px solid #ccc; }

@media(max-width:600px){
table,thead,tbody,tr,td{display:block;width:100%}
thead{display:none}
tr{
    margin-bottom:15px;
    background:var(--card);
    padding:10px;
    border-radius:6px;
}
td{
    text-align:right;
    padding-left:50%;
    position:relative;
}
td::before{
    content:attr(data-label);
    position:absolute;
    left:10px;
    font-weight:bold;
}
}
</style>
</head>

<body>

<div class="container">

<h1>
ðŸ’° Mysore & Coorg Expense Tracker
<span class="toggle" onclick="toggleDark()">ðŸŒ™ Dark Mode</span>
</h1>

<div class="card">
<h2>âž• Log Expense</h2>
<form id="expense-form">

<div class="grid grid-2">
<div>
<label>Date</label>
<input type="date" id="Date" required>
</div>
<div>
<label>Amount</label>
<input type="number" id="Amount" step="0.01" required>
</div>
</div>

<label>Description</label>
<input type="text" id="Description" required>

<div class="grid grid-2">
<div>
<label>Category</label>
<select id="Category">
<option>Food</option>
<option>Accommodation</option>
<option>Transport</option>
<option>Activities</option>
<option>Shopping</option>
</select>
</div>
<div>
<label>Payer</label>
<select id="Payer"></select>
</div>
</div>

<button type="submit">Submit Expense</button>
<p id="message"></p>
</form>
</div>

<div class="card">
<h3>ðŸ§¾ All Expenses</h3>
<table id="expense-list-table">
<thead>
<tr>
<th>Date</th>
<th>Description</th>
<th>Amount</th>
<th>Payer</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>

<script>
/* âœ… SAME WEB APP URL */
const WEB_APP_URL =
'https://script.google.com/macros/s/AKfycbwG_q83JHgzkjW5jQbVhSRSCN0sPvSrc7PoidwNAqYVIy3uA9um3ScRiNZSXA4Hw9qYtg/exec';

/* ðŸ”’ Fixed Participants */
const PARTICIPANTS = [
 "Sudharsan",
 "Varadhaganapathy",
 "Aathavan",
 "Surendhar"
];

/* Date default */
Date.value = new Date().toISOString().substring(0,10);

/* Populate payer dropdown */
PARTICIPANTS.forEach(p=>{
const o=document.createElement("option");
o.value=o.textContent=p;
Payer.appendChild(o);
});

/* Dark mode persistence */
function toggleDark(){
document.body.classList.toggle("dark");
localStorage.setItem("dark",
document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true")
document.body.classList.add("dark");

/* Render expense table */
function renderExpenseList(data){
const tbody=document.querySelector("tbody");
tbody.innerHTML="";
data.reverse().forEach(e=>{
tbody.innerHTML+=`
<tr>
<td data-label="Date">${e.Date}</td>
<td data-label="Description">${e.Description}</td>
<td data-label="Amount">â‚¹${Number(e.Amount).toFixed(2)}</td>
<td data-label="Payer">${e.Payer}</td>
</tr>`;
});
}

/* Submit expense */
document.getElementById("expense-form")
.addEventListener("submit",async e=>{
e.preventDefault();
message.textContent="Submitting...";

const payload={
Date:Date.value,
Amount:Number(Amount.value).toFixed(2),
Description:Description.value,
Category:Category.value,
Payer:Payer.value,
Participants:PARTICIPANTS.join(", ")
};

await fetch(WEB_APP_URL,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(payload)
});

message.textContent="âœ… Expense added";
e.target.reset();
Date.value=new Date().toISOString().substring(0,10);
});
</script>

</body>
</html>
